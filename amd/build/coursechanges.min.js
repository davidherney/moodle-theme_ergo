define(["jquery","core/modal_factory"],function(t,e){"use strict";return{init:function(){t(".banner-top").parents(".no-overflow").removeClass("no-overflow");t(".menucontroler").on("mouseover touchstart",function(){var e=t(this),a=e.parents(".box_resources");if(0!=a.length){var i=t(a[0]);i.find(".selected").removeClass("selected"),i.find("[data-rel]").hide(),i.find('[data-rel="'+e.attr("data-type")+'"]').show(),e.addClass("selected")}}),t(".menucontroler").on("touchend",function(){var e=t('[data-rel="'+t(this).attr("data-type")+'"]');t("html, body").animate({scrollTop:e.offset().top},500)}),t(".attachedimages").each(function(){var e=t(this);e.find("br").remove(),e.find("img").first().addClass("active");var a=function(){var t=e.find("img.active"),a=t.next("img");t.removeClass("active"),a.length>0?a.addClass("active"):e.find("img").first().addClass("active")};
if(e.find("img").length>0){e.find("img").on("click",a);var i=t('<div class="slide-control" data-action="before">&#60;</div>');i.on("click",function(){var t=e.find("img.active"),a=t.prev("img");t.removeClass("active"),a.length>0?a.addClass("active"):e.find("img").last().addClass("active")}),e.append(i);var n=t('<div class="slide-control" data-action="after">&#62;</div>');n.on("click",a),e.append(n)}else e.hide()}),t("completion.complete").parents(".completion-parent").addClass("complete"),t("completion.incomplete").parents(".completion-parent").addClass("incomplete"),t("[data-dhbg-toggle]").on("click",function(){var e=t(this),a=e.attr("data-dhbg-toggle"),i=e.attr("data-target");t(i).toggleClass(a)}),t(".tepuy-transition").on("click",function(e){e.preventDefault();
var a=t(this),i=t(a.attr("data-show")),n=t(a.attr("data-hide")),r=a.attr("data-transition"),o=a.attr("data-duration")?parseInt(a.attr("data-duration")):400;r?n.hide(o,r,function(){i.show(o,r)}):(n.hide(),i.show())}),t(".tepuy-wf").each(function(){var e=t(this);e.wrapInner("<div class='tepuy-body'></div>");var a="";e.attr("data-property-width")&&(a+="width:"+e.attr("data-property-width")+";"),e.attr("data-property-height")&&(a+="height:"+e.attr("data-property-height")+";");
var i=t('<div class="tepuy-close">X</div>');i.on("click",function(){e.hide({effect:"slide",direction:"down"})}),""!=a&&e.attr("style",a),e.append(i),e.hide()}),t(".tepuy-wf-controller").on("click",function(){var e=t(this),a=e.attr("data-property-width"),i=e.attr("data-property-height"),n=t(e.attr("data-property-content"));a&&n.css("width",a),i&&n.css("height",i),n.show({effect:"slide",direction:"down"})}),t(".tepuy-w").each(function(){var e=t(this);if(!(e.parents('[data-fieldtype="editor"]')&&e.parents('[data-fieldtype="editor"]').length>0)){if(e.wrapInner("<div class='tepuy-body'></div>"),e.attr("data-tepuy-showentry")||e.attr("data-tepuy-showconcept")){var a={};e.attr("data-tepuy-showentry")?a.eid=e.attr("data-tepuy-showentry"):e.attr("data-tepuy-showconcept")&&M.ergo&&M.ergo.courseid&&(a.concept=e.attr("data-tepuy-showconcept"),a.courseid=M.ergo.courseid),t.get(M.cfg.wwwroot+"/mod/glossary/showentry_ajax.php",a,function(t){if(t.entries&&Object.keys(t.entries).length>0){
var a="";Object.keys(t.entries).forEach(function(e,i){t.entries[e].definition&&(a=t.entries[e].definition)}),e.find(".tepuy-body").html(a)}},"json")}else if(e.attr("data-tepuy-innerentry"))e.find("a.glossary.autolink").length>0&&(t.get(e.find("a.glossary.autolink").attr("href").replace("showentry.php","showentry_ajax.php"),function(t){t.entries&&t.entries.length>0&&e.find(".tepuy-body").html(t.entries[0].definition)},"json"),e.attr("title",e.find("a.glossary.autolink").attr("title")));else if(e.attr("data-tepuy-innerautolink")&&e.find("a.autolink").length>0){var i=e.find("a.autolink").attr("href")+"&inpopup=true";e.find("a.autolink").hide();var n=t("<iframe></iframe>");n.attr("src",i),n.on("load",function(){n.contents().find("a:not([target])").attr("target","_top")}),e.find(".tepuy-body").append(n),e.attr("title",e.find("a.autolink").html())}e.hide()}}),t(".tepuy-w-controller").on("click",function(e){e.preventDefault();
var a=t(this);if(!(a.parents('[data-fieldtype="editor"]')&&a.parents('[data-fieldtype="editor"]').length>0)){if(!(c=a.data("dialogue"))){var i=a.attr("data-property-width"),n=a.attr("data-property-height"),r={center:!0,modal:!0,visible:!1,draggable:!1,width:"auto",height:"auto",autofillheight:"header",bodyContent:t(a.attr("data-tepuy-content")+" .tepuy-body")};if(i){if(i.indexOf("%")>=0){var o=t(window).width(),d=Number(i.replace("%",""));!isNaN(d)&&d>0&&(i=d*o/100)}r.width=i}if(n){if(n.indexOf("%")>=0){var s=t(window).height(),l=Number(n.replace("%",""));!isNaN(l)&&l>0&&(n=l*s/100)}r.height=n}var c=new M.core.dialogue(r);a.data("dialogue",c)}c.show()}}),t(".tepuy-openinmodal").each(function(){
var e=t(this);e.parents('[data-fieldtype="editor"]')&&e.parents('[data-fieldtype="editor"]').length>0||(e.find("a").each(function(t){this.removeAttribute("onclick")}),e.find("a").on("click",function(a){a.preventDefault();var i=t(this);if(!(v=i.data("dialogue"))){var n=e.attr("data-property-width"),r=e.attr("data-property-height"),o=i.attr("href")+"&inpopup=true",d=t('<iframe class="tepuy-openinmodal-container"></iframe>');d.attr("src",o),d.on("load",function(){d.contents().find("a:not([target])").attr("target","_top")});var s=t.fn.hide;t.fn.hide=function(){
return this.trigger("hide"),s.apply(this,arguments)},d.on("hide",function(){console.log("SE OCULTÃ³")});var l=t("<div></div>");l.append(d);var c={center:!0,modal:!0,visible:!1,draggable:!0,width:"auto",height:"auto",autofillheight:"header",bodyContent:l};if(n){if(n.indexOf("%")>=0){var h=t(window).width(),p=Number(n.replace("%",""));!isNaN(p)&&p>0&&(n=p*h/100)}c.width=n}if(r){if(r.indexOf("%")>=0){var f=t(window).height(),u=Number(r.replace("%",""));!isNaN(u)&&u>0&&(r=u*f/100)}c.height=r}var v=new M.core.dialogue(c);i.data("dialogue",v),v.after("visibleChange",function(t){"visible"===t.attrName&&t.prevVal&&!t.newVal&&d.contents().find("video, audio").each(function(){this.pause()})},v)}v.show()}))})}}});
